\section{Conditional Expectation}
\begin{ddefinition*}[Conditional expectation on an event]
  Let \((\O, \F, \P)\) denote a discrete probability space and let \(B \in \F\) denote an event with \(\P(B) > 0\). Then we can define the average expected value of a random variable \(X\) depending on \(B\) as:
  \begin{align*}
    \E(X \mid B) &= \frac{\E(\I_B X)}{\P(B)} = \sum_{x \in \chi} x \cdot \P(X = x \mid B) \\
    &= \sum_{\omega \in \O} X(\omega) \P(\{\omega\} \mid B)
  \end{align*}
\end{ddefinition*}

\begin{cdefinition*}[Conditional expectation with event]
  Let \(X\) be a continuous random variable. The expected value of \(X\) given \(Y = y\) is defined as
  \[\E(X \mid Y = y) := \int x \ f_{X \mid Y}(x \mid y) \,dx\]
  The same holds if \(X\) is discrete, in that case, we replace the integral by a sum over \(x \in \chi\).
\end{cdefinition*}

This introduces a new random variable:
\[\omega \in \O \mapsto Y(\omega) \mapsto \E(X \mid Y = Y(\omega))\]
We define \(\E(X \mid Y)\) to denote this new random variable and call it the conditional expectation of \(X\) given \(Y\).

\begin{ddefinition*}[Conditional expectation as random variable]
  Let \(\B = (B_i)_{i \in I}\) be a countable partition of \(\O\). Then \(\E(X \mid \B)\) defines a new variable written as:
  \[\E(X \mid \B)(\omega) = \sum_{i \in I, \P(B_i) > 0} \E(X \mid B_i) \I_{B_i}(\omega)\]
\end{ddefinition*}

The intuition behind this definition is when we fix \(\tilde{\omega} \in \O\), then w.l.o.g. assume \(\tilde{\omega} \in B_1\), then
\[\E(X \mid \B)(\tilde{\omega}) = \E(X \mid B_1)(\tilde{\omega})\]

\begin{dtheorem*}[Multiple random variables]
  Let \(Y \in \L^2((\O, \mathcal{G}, \P); \R)\), then
  \[\E(XY \mid \mathcal{G}) = Y \cdot \E(X \mid \mathcal{G})\]
\end{dtheorem*}

\begin{theorem*}[Tower Property]
  \[\E(X) = \E(\E(X \mid Y))\]
\end{theorem*}
